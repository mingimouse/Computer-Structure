# 다양한 입출력 방법

## 01. 프로그램 입출력 (programmed I/O)

### I. 기본 개념

<img src="./img/computer-structure-0604.png" width="700px">

`프로그램 입출력`: 기본적으로 프로그램 속 명령어로 입출력장치를 제어하는 방법<br>

1. CPU는 장치 컨트롤러의 제어 레지스터에 쓰기 명령을 보낸다.<br>

2. 장치 컨트롤러는 상태 레지스터의 상태를 확인한다.<br>

3. 준비가 되면 메모리의 정보를 데이터 레지스터에 쓴다.<br>

CPU는 `외부`에 있는 장치 컨트롤러 속 레지스터들을 알기 어렵다.<br>

따라서 '메모리 맵 입출력'과 '고립형 입출력' 방식을 사용해 장치 컨트롤러 속 레지스터를 파악한다.<br>

<br>

### II. 메모리 맵 입출력 (memory-mapped I/O) 

<img src="./img/computer-structure-0605.png" width="800px">

메모리에 위한 주소 공간과 입출력장치를 위한 주소 공간을 하나의 공간으로 간주하는 방법<br>

- 1024개의 주소 공간이 있을 때 512개는 메모리 주소를, 512개는 장치 컨트롤러의 레지스터를 표현<br>

- 메모리와 입출력장치에 같은 명령어를 사용할 수 있는 장점이 있다.<br>

- 메모리의 주소 공간이 축소된다는 단점이 있다.<br>

<br>

### III. 고립형 입출력 (isolated I/O)

<img src="./img/computer-structure-0606.png" width="100%">

메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법<br>

- 1024개의 주소 공간이 있을 때 메모리와 입출력장치 모두 1024개의 주소 공간을 활용할 수 있다.<br>

- `제어버스`에 '메모리 선'과 '입출력장치 선'이 따로 있기 때문이다.<br>

- 메모리의 주소 공간이 축소되지 않는다는 장점이 있다.<br>

- 입출력 전용 명령어를 사용해야 된다는 단점이 있다.<br>

---

## 02. 인터럽트 기반 입출력 (Interrupt-Driven I/O)

### I. 기본 개념

<img src="./img/computer-structure-0607.png" width="600px">

`인터럽트 기반 입출력`: 인터럽트를 기반으로 하는 입출력<br>

정확히 말하면, 인터럽트는 입출력장치가 아니라 장치 컨트롤러에 의해 발생한다.<br>

1. CPU가 입출력 장치에게 작업을 명령한다.<br>

2. 입출력장치가 작업을 수행하는 동안, CPU는 다른 작업을 한다.<br>

3. 입출력 작업이 끝나면, 장치 컨트롤러가 CPU에게 인터럽트 요청 신호를 보낸다.<br>

4. CPU는 하던 일을 백업하고, 인터럽트 서비스 루틴을 실행한다.<br>

<br>

### II. 인터럽트 vs 폴링

`폴링(poliing)`: CPU가 인터럽트를 받지 않고, 주기적으로 장치 컨트롤러를 확인하는 방식<br>

주기적으로 장치 컨트롤러의 상태 레지스터를 확인해야 하기 때문에 CPU의 부담이 크다.<br>

따라서 인터럽트 기반 입출력 방식을 사용하는 것이 더 효율적이다.<br>

<br>

### III. 다중 인터럽트 처리

<img src="./img/computer-structure-0608.png" width="800px">

인터럽트의 우선순위가 상관 없는 경우, 순서대로 인터럽트 서비스 루틴을 실행한다.<br>

인터럽트 처리 중 우선 순위가 더 큰 인터럽트가 발생한 경우, 우선 순위가 높은 인터럽트부터 처리한다.<br>

막을 수 없는 인터럽트(`NMI`: Non-Maskable Interrupt)가 발생한 경우에도 우선 순위가 높은 인터럽트부터 처리한다.<br>

<br>

### IV. PIC (Programmable Interrupt Controller)

<img src="./img/computer-structure-0609.png" width="700px">

여러 장치 컨트롤러에 연결되어 하드웨어 인터럽트 요청의 우선 순위를 판별하고,<br>

CPU에게 지금 처리해야 할 하드웨어 인터럽트는 무엇인지 알려주는 하드웨어다.<br>

PIC는 인터럽트 비트를 통해 막을 수 있는 하드웨어 인터럽트의 우선순위만 판별 (NMI는 판별 X)<br>

1. PIC가 장치 컨트롤러에서 `인터럽트 요청 신호`를 받아들인다.<br>

2. PIC는 인터럽트 우선순위를 판단하고, CPU에게 `인터럽트 요청 신호`를 보낸다.<br>

3. CPU는 PIC에게 인터럽트 확인 신호를 보낸다.<br>

4. PIC는 데이터 버스를 통해 CPU에게 `인터럽트 벡터`를 보낸다.<br>

5. CPU는 해당 장치의 `인터럽트 서비스 루틴`을 실행한다.<br>

---

## 03. DMA 입출력 (Direct Memory Access)

[]

 
